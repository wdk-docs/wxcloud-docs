:wxcloud:`索引管理 <guide/database/index>`
==========================================

建立索引是保证数据库性能、保证小程序体验的重要手段。
我们应为所有需要成为查询条件的字段建立索引。
建立索引的入口在控制台中，可分别对各个集合的字段添加索引。


单字段索引
------------

对需要作为查询条件筛选的字段，我们可以创建单字段索引。
如果需要对嵌套字段进行索引，那么可以通过 "点表示法" 用点连接起嵌套字段的名称。
比如我们需要对如下格式的记录中的 ``color`` 字段进行索引时，可以用 ``style.color`` 表示。


.. code-block:: json

  {
    "_id": "",
    "style": {
      "color": ""
    }
  }

在设置单字段索引时，指定排序为升序或降序并没有关系。
在需要对索引字段按排序查询时，数据库能够正确的对字段排序，无论索引设置为升序还是降序。


组合索引
-----------

组合索引即一个索引包含多个字段。
当查询条件使用的字段包含在索引定义的所有字段或前缀字段里时，会命中索引，优化查询性能。
索引前缀即组合索引的字段中定义的前 1 到多个字段，如有在 A, B, C 三个字段定义的组合索引 A, B, C，那么 A 和 A, B 都属于该索引的前缀。


组合索引具有以下特点：

1. 字段顺序决定索引效果

  定义组合索引时，多个字段间的顺序不同是会有不同的索引效果的。
  比如对两个字段 A 和 B 进行索引，定义组合索引为 A, B 与定义组合索引为 B, A 是不同的。
  当定义组合索引为 A, B 时，索引会先按 A 字段排序再按 B 字段排序。
  因此当组合索引设为 A, B 时，即使我们没有单独对字段 A 设立索引，但对字段 A 的查询可以命中 A, B 索引。
  需要注意的是，此时对字段 B 的查询是无法命中 A, B 索引的，因为 B 不属于索引 A, B 的前缀之一。

2. 字段排序决定排序查询是否可以命中索引

  加入我们对字段 A 和 B 设置以下索引：

    A: 升序
    B: 降序

  那么当我们查询需要对 A, B 进行排序时，可以指定排序结果为 A 升序 B 降序或 A 降序 B 升序，但不能指定为 A 升序 B 升序或 A 降序 B 降序。


索引属性
-----------

唯一性限制
~~~~~~~~~~~~~

创建索引时可以指定增加唯一性限制，具有唯一性限制的索引会要求被索引集合不能存在被索引字段值都相同的两个记录。
即对任意具有唯一性限制的索引 I，假设其索引字段为 ``<F1, F2, ..., Fn>``，则对集合 S 中任意的两个记录 R1 和 R2，
必须满足条件 ``R1.F1 != R2.F1 && R1.F2 != R2.F2 && ... && R1.Fn != R2.Fn``。
需特别注意的是，假如记录中不存在某个字段，则对索引字段来说其值默认为 null，如果索引有唯一性限制，则不允许存在两个或以上的该字段为空 / 不存在该字段的记录。


在创建索引的时候索引属性选择 唯一 即可添加唯一性限制。
